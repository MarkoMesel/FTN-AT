<!DOCTYPE html>
<html ng-app="angApp">
<head>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.css" />
	<script src="http://code.jquery.com/jquery-2.0.1.min.js"></script>
	
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>
	
	<meta charset="ISO-8859-1">

 <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.5/angular.min.js"></script>
<script src="js/angularapp.js"></script>

<title>KLIJENTSKA APLIKACIJA</title>

<style type="text/css">

</style>


</head>
<body>
    <h1 class="pb-4" align="center" ><strong>Klijentska Aplikacija</strong></h1>
    <div class="container w-50 border">
	    <div class="row form-inline" >
		    <div class="col border" align="center">
		    	<h3 class="" ><strong>Create New Agent</strong></h3>
		    </div>
	    </div>
	    <div class="row">
		    <div class="col border">
		    	<div class="col form-inline">
			    	<div class="col-6">
			    		<span class="">Agent Type - Name: </span>
			    	</div>			    	
			    	<div class="col">
			    		<select id="CNATName" style="width:100%">
			            	<option value="ping">Ping</option>
			            	<option value="pong">Pong</option>
			            	<option value="initiator">Initiator</option>
			            	<option value="participant">Participant</option>
			            </select>
			    	</div>
			    </div>
			    <div class="col form-inline">
			    	<div class="col-6">
			    		<span class="">Agent Type - Module: </span>
			    	</div>
			    	<div class="col">
			    		<input name="CNATModule" style="width:100%"></input>
			    	</div>
			   	</div>
		    	<div class="col form-inline">
			    	<div class="col-6">
			    		<span class="">Agent Name: </span>
			    	</div>
			    	<div class="col">
			    		<input name="CNAName" style="width:100%"></input>
			    	</div>
			   	</div>
	    	</div>

	    </div>
	    <div class="row form-inline">
	    	<div class="col border" align="center">
	    		<button id="createAgentBtn" name="CNABtn" onclick="createAgent()">Create Agent</button>
	    	</div>
	    </div>
    </div>
    </br>
    </br>
    <div class="container w-50 border">
	    <div class="row form-inline" >
		    <div class="col border" align="center">
		    	<h3 class="" ><strong>Start Server Agent</strong></h3>
		    </div>
	    </div>
	    <div class="row">
		    <div class="col border">
		    	<div class="col form-inline">
			    	<div class="col-6">
			    		<span class="">Agent Type (nam - mod): </span>
			    	</div>
			    	
			    	<div class="col">
			    		<select id="stAgType" style="width:100%">
			            	<option value="">-</option>
			            </select>
			    	</div>
			    </div>
		    	<div class="col form-inline">
			    	<div class="col-6">
			    		<span class="">Agent Name: </span>
			    	</div>
			    	<div class="col">
			    		<input name="stAgName" style="width:100%"></input>
			    	</div>
			   	</div>
	    	</div>

	    </div>
	    <div class="row form-inline">
	    	<div class="col border" align="center">
	    		<button id="startAgentBtn" name="SSABtn" onclick="startAgent()">Start Agent</button>
	    	</div>
	    </div>
    </div>
    </br>
    </br>
    <div class="container w-50 border">
	    <div class="row form-inline" >
		    <div class="col border" align="center">
		    	<h3 class="" ><strong>Stop Server Agent</strong></h3>
		    </div>
	    </div>
	    <div class="row">
		    <div class="col border">
		    	<div class="col form-inline">
			    	<div class="col-6">
			    		<span class="">Agent Type (nam - mod): </span>
			    	</div>
			    	
			    	<div class="col">
			    		<select id="stopType" style="width:100%">
			            	<option value="">-</option>
			            </select>
			    	</div>
			    </div>
		    	<div class="col form-inline">
			    	<div class="col-6">
			    		<span class="">Agent Name: </span>
			    	</div>
			    	<div class="col">
			    		<input name="stopName" style="width:100%"></input>
			    	</div>
			   	</div>
	    	</div>

	    </div>
	    <div class="row form-inline">
	    	<div class="col border" align="center">
	    		<button id="stopAgentBtn" name="STOPBtn" onclick="stopAgent()">Stop Agent</button>
	    	</div>
	    </div>
    </div>
    <br />
    <br />
	<div class="container w-50 border">
	    <div class="row form-inline" >
		    <div class="col border" align="center">
		    	<h3 class="" ><strong>Agent Communication</strong></h3>
		    </div>
	    </div>
	    <div class="row">
		    <div class="col border">
		    	<div class="col form-inline">
			    	<div class="col-6">
			    		<span class="">Sender: </span>
			    	</div>
			    	<div class="col">
			    		<select id="agSender" style="width:100%">
			            	<option value="">-</option>
			            </select>
			    	</div>
			    </div>
		    	<div class="col form-inline">
			    	<div class="col-6">
			    		<span class="">Receiver: </span>
			    	</div>
			    	<div class="col">
			    		<select id="agReceiver" style="width:100%">
			            	<option value="">-</option>
			            </select>
			    	</div>
			   	</div>
			   	<div class="col form-inline">
			    	<div class="col-6">
			    		<span class="">Performative: </span>
			    	</div>
			    	<div class="col">
			    		<select id="performativeSelect" style="width:100%">
			            	<option value="">-</option>
			            </select>
			    	</div>
			    </div>
			    <div class="col form-inline">
			    	<div class="col-6">
			    		<span class="">Content: </span>
			    	</div>
			    	<div class="col">
			    		<input name="messageContent" style="width:100%" />
			    	</div>
			    </div>
	    	</div>
	    </div>
	    <div class="row form-inline">
	    	<div class="col border" align="center">
	    		<button id="sendMessageBtn" name="SMBtn" onclick="sendMessageToServer()">Send Message</button>
	    	</div>
	    	<!--
	    	<div class="col border" align="center">
	    		<button class="" type="button " onclick="populatePerformativeSelect();">POPULATE PERFORMATIVE COMBOBOX</button>
	    	</div>
	    	-->
	    </div>
    </div>

    <script>
	
    	window.onload = function() {
    		populatePerformativeSelect();
    		getAgentTypes();
    	};

		function populatePerformativeSelect() {
			
			var select = document.getElementById("performativeSelect");
		    
		    fetch('/RA5013AT-WAR/rest/messages')
		    .then(response => response.text())
		    .then(data => {
		    	var stringFromData = JSON.stringify(data);
		    	var trimmedString = stringFromData.substr(2,stringFromData.length-4);
		    	var performativeArray = trimmedString.split(',');
		    	for(var i = 0; i < performativeArray.length; i++) {
		            var option = document.createElement("OPTION");
		            var txt = document.createTextNode(performativeArray[i]);
		            option.appendChild(txt);
		            select.insertBefore(option, select.lastChild);
		        }
		    });

		}

		function getAgentTypes() {
			var select1 = document.getElementById("stAgType");
			var i;
		    for(i = select1.options.length - 1 ; i >= 1 ; i--)
		    {
		        select1.remove(i);
		    }
		    var select2 = document.getElementById("stopType");
			var i;
		    for(i = select2.options.length - 1 ; i >= 1 ; i--)
		    {
		        select2.remove(i);
		    }
		    fetch('/RA5013AT-WAR/rest/agents/classes')
		    .then(response => response.text())
		    .then(data => {
		    	var stringFromData = JSON.stringify(data);
		    	var trimmedString = stringFromData.substr(2,stringFromData.length-4);
		    	var performativeArray = trimmedString.split(',');
		    	for(var i = 0; i < performativeArray.length; i++) {
			    	
		            var option = document.createElement("OPTION");
		            var txt = document.createTextNode(performativeArray[i]);
		            option.appendChild(txt);
		            select1.insertBefore(option, select1.lastChild);

		            var option = document.createElement("OPTION");
		            var txt = document.createTextNode(performativeArray[i]);
		            option.appendChild(txt);
		            select2.insertBefore(option, select2.lastChild);
		        }
		    });
		    select.selectmenu("refresh", true);
		}

		function getRunningAgents() {
			var select1 = document.getElementById("agSender");
			var i;
		    for(i = select1.options.length - 1 ; i >= 1 ; i--)
		    {
		        select1.remove(i);
		    }
		    var select2 = document.getElementById("agReceiver");
			var i;
		    for(i = select2.options.length - 1 ; i >= 1 ; i--)
		    {
		        select2.remove(i);
		    }

		    fetch('/RA5013AT-WAR/rest/agents/running')
		    .then(response => response.text())
		    .then(data => {
		    	var stringFromData = JSON.stringify(data);
		    	var trimmedString = stringFromData.substr(2,stringFromData.length-4);
		    	var performativeArray = trimmedString.split(',');
		    	for(var i = 0; i < performativeArray.length; i++) {

		            var option = document.createElement("OPTION");
		            var txt = document.createTextNode(performativeArray[i]);
		            option.appendChild(txt);
		            select1.insertBefore(option, select1.lastChild);

		            var option = document.createElement("OPTION");
		            var txt = document.createTextNode(performativeArray[i]);
		            option.appendChild(txt);
		            select2.insertBefore(option, select2.lastChild);
		        }
		    });
		    select1.selectmenu("refresh", true);
		    select2.selectmenu("refresh", true);
		    
		}
		function createAgent() { 
			var e = document.getElementById("CNATName");
			 var stgTypeVar = e.options[e.selectedIndex].value;
			 var parameter = stgTypeVar + "/"
			 							+ document.getElementsByName("CNATModule")[0].value + "/"
			 							+ document.getElementsByName("CNAName")[0].value;
			 var path = "/RA5013AT-WAR/rest/agents/"
				 			 + parameter;
			$.ajax({
			    type: "POST",
			    url: path,
			    //contentType: "text/plain".
			    //data: parameter,
			    success: function(msg){
			        getAgentTypes();
			    }
			});
		}

		function startAgent() {
			 var e = document.getElementById("stAgType");
			 var stgTypeVar = e.options[e.selectedIndex].value;
			 var parameter = stgTypeVar + "/"
			 							+ document.getElementsByName("stAgName")[0].value;
			 var path = "/RA5013AT-WAR/rest/agents/running/"
				 			 + parameter;
			$.ajax({
			    type: "PUT",
			    url: path,
			    //contentType: "text/plain".
			    //data: parameter,
			    success: function(msg){
			        getRunningAgents();
			    }
			});
			//alert("KRAJ!");
		}
		
		function stopAgent() {
			 var e = document.getElementById("stopType");
			 var stgTypeVar = e.options[e.selectedIndex].value;
			 var parameter = stgTypeVar + " - "
 			 							+ document.getElementsByName("stopName")[0].value;
			 var path = "/RA5013AT-WAR/rest/agents/running/"
				 			 + parameter;
			$.ajax({
			    type: "DELETE",
			    url: path,
			    //contentType: "text/plain".
			    //data: parameter,
			    success: function(msg){
			        getRunningAgents();
			    }
			});
			//alert("KRAJ!");
		}

		function sendMessageToServer() {
			var e = document.getElementById("agSender");
			var sender = e.options[e.selectedIndex].value;
			e = document.getElementById("agReceiver");
			var receiver = e.options[e.selectedIndex].value;
			e = document.getElementById("performativeSelect");
			var performative = e.options[e.selectedIndex].value;
			var message = document.getElementsByName("messageContent")[0].value;

			var dataToSend = [sender, receiver, performative, message];
			var dataToSendJSON = JSON.stringify(dataToSend);

			//alert(dataToSendJSON);
			
			var path = "/RA5013AT-WAR/rest/messages";

			$.ajax({
			    url: path,
			    type: 'POST',
			    contentType: 'application/json',
			    data: dataToSendJSON,
			    success: function(msg){
		        //alert("USPELO JE!");
		    }
			});
		}
	</script>
	
</body>
</html>